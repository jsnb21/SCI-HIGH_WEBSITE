<!DOCTYPE html>
<html>
<head>
  <title>Sky High Leaderboards</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<script>// Enable dark mode in Tailwind
  tailwind.config = {
    darkMode: 'class',
  };</script>
<body class="bg-gray-100">
  <div class="flex items-center justify-center h-screen bg-gray-100">
    <div class="bg-white shadow-md rounded-lg p-6 max-w-7xl w-full border border-gray-300">
      <h2 class="text-2xl font-bold mb-4 text-center">Sky High Leaderboards</h2>
      <p class="text-gray-700 mb-4">Check out the latest scores and ranks!</p>
      <div id="playerRecordsContainer" class="overflow-x-auto"></div>
      <div class="flex justify-center mt-4">
        <button id="themeToggle" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 dark:bg-yellow-500 dark:hover:bg-yellow-600">
          Toggle Dark Mode
        </button>
      </div>
    </div>
  </div>

  <!-- Div for player leaderboard -->
  <div id="playerRecordsContainer" class="flex justify-center p-6"></div>


  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
      authDomain: "sci-high-website.firebaseapp.com",
      databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app", // âœ… Added!
      projectId: "sci-high-website",
      storageBucket: "sci-high-website.appspot.com",
      messagingSenderId: "451463202515",
      appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
  };
  
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function convertRankToHTML(rankString) {
      // Mapping of RPGMaker color indexes to hex codes
      const colorMap = {
          16: "#00FFFF", // Cyan color for A Rank
          17: "#FFD700", // Gold color for S Rank
          18: "#FF4500", // Orange color for B Rank
          0: "#FFFFFF"   // Default white color
      };
  
      // Match the pattern \\C[n]
      const colorRegex = /\\C\[(\d+)\](.*?)\\C\[0\]/;
  
      const match = rankString.match(colorRegex);
      if (match) {
          const colorIndex = parseInt(match[1]);
          const text = match[2];
          const color = colorMap[colorIndex] || "#FFFFFF";
  
          return `<span style="color: ${color}; font-weight: bold;">${text}</span>`;
      } else {
          return rankString; // If no color code, return as is
      }
  }
// / Function to display all player records from Firebase
function displayAllPlayerRecords() {
  const db = firebase.database();

  db.ref('playerRecords')
    .orderByChild('score')
    .once('value')
    .then(snapshot => {
        const players = [];
        snapshot.forEach(childSnapshot => {
            players.push(childSnapshot.val());
        });

        players.reverse(); // High scores first

        const container = document.getElementById('playerRecordsContainer');
        if (!container) {
            console.warn('No container element found to display player records!');
            return;
        }

        container.innerHTML = '';

        // Create Tailwind-styled table
        const table = document.createElement('table');
        table.className = 'min-w-full bg-white shadow-md rounded-lg overflow-hidden';

        // Create header row
        const thead = document.createElement('thead');
        thead.className = 'bg-gray-200';
        const headerRow = document.createElement('tr');
        const headers = [
            'No. ', 'Name', 'Score', 'HTML', 'CSS', 'Python', 'DS', 
            'Clear Time', 'Mistakes', 'Rank', 'Timestamp', 'Badges'
        ];

        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            th.className = 'py-3 px-6 text-xs font-bold uppercase tracking-wider text-gray-600 text-center border-b';
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);

          // Create table body
          const tbody = document.createElement('tbody');

          players.forEach((player, index) => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-100';

            const rankHtml = convertRankToHTML(player.rank);

            const rowData = [
              `No. ${index + 1}`,
              player.name,
              player.score,
              `${player.htmlScore}%`,
              `${player.cssScore}%`,
              `${player.pythonScore}%`,
              `${player.dsScore}%`,
              player.clearTime,
              player.mistakes,
              rankHtml,
              new Date(player.timestamp).toLocaleDateString(),
              'Badges here'
            ];

            rowData.forEach(data => {
              const td = document.createElement('td');
              td.className = 'py-4 px-6 text-sm text-gray-700 text-center border-b';
              td.innerHTML = data;
              row.appendChild(td);
            });

            tbody.appendChild(row);
          });

          table.appendChild(tbody);
          container.appendChild(table);

          console.log(`Displayed ${players.length} player records.`);
        })
        .catch(error => {
          console.error('Error fetching player records:', error);
        });
    }


window.addEventListener('load', function() {
    displayAllPlayerRecords();
    setInterval(displayAllPlayerRecords, 1000); // Reload every 2 seconds
});

  </script>
</body>
</html>
