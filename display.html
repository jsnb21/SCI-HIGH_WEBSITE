<!DOCTYPE html>
<html>
<head>
  <title>Game Stats</title>
</head>
<body>
  <h2 style="padding: 20px; display: flex; justify-content: center; align-items: center;">Leaderboards!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</h2>
  <!-- Div for player leaderboard -->
  <div id="playerRecordsContainer" style="padding: 20px; display: flex; justify-content: center; align-items: center; height: 100vh;">
  </div>


  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
      authDomain: "sci-high-website.firebaseapp.com",
      databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app", // âœ… Added!
      projectId: "sci-high-website",
      storageBucket: "sci-high-website.appspot.com",
      messagingSenderId: "451463202515",
      appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
  };
  
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function convertRankToHTML(rankString) {
      // Mapping of RPGMaker color indexes to hex codes
      const colorMap = {
          16: "#00FFFF", // Cyan color for A Rank
          17: "#FFD700", // Gold color for S Rank
          18: "#FF4500", // Orange color for B Rank
          0: "#FFFFFF"   // Default white color
      };
  
      // Match the pattern \\C[n]
      const colorRegex = /\\C\[(\d+)\](.*?)\\C\[0\]/;
  
      const match = rankString.match(colorRegex);
      if (match) {
          const colorIndex = parseInt(match[1]);
          const text = match[2];
          const color = colorMap[colorIndex] || "#FFFFFF";
  
          return `<span style="color: ${color}; font-weight: bold;">${text}</span>`;
      } else {
          return rankString; // If no color code, return as is
      }
  }
// / Function to display all player records from Firebase
function displayAllPlayerRecords() {
  const db = firebase.database();

  db.ref('playerRecords')
    .orderByChild('score')
    .once('value')
    .then(snapshot => {
        const players = [];
        snapshot.forEach(childSnapshot => {
            players.push(childSnapshot.val());
        });

        players.reverse(); // High scores first

        const container = document.getElementById('playerRecordsContainer');
        if (!container) {
            console.warn('No container element found to display player records!');
            return;
        }

        container.innerHTML = '';

        // Create the table and header
        const table = document.createElement('table');
        table.style.borderCollapse = 'collapse';
        table.style.width = '90%';
        table.style.textAlign = 'center';

        // Create header row
        const headerRow = document.createElement('tr');
        const headers = [
            'No. ', 'Name', 'Score', 'HTML', 'CSS', 'Python', 'DS', 
            'Clear Time', 'Mistakes', 'Rank', 'Timestamp', 'Badges'
        ];
        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            th.style.border = '1px solid black';
            th.style.padding = '8px';
            th.style.backgroundColor = '#f2f2f2';
            headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        // Create one row per player
        players.forEach((player, index) => {
            const row = document.createElement('tr');

            const rankHtml = convertRankToHTML(player.rank);

            const rowData = [
                `No. ${index + 1}`,
                player.name,
                player.score,
                player.htmlScore,
                player.cssScore,
                player.pythonScore,
                player.dsScore,
                player.clearTime,
                player.mistakes,
                rankHtml,
                new Date(player.timestamp).toLocaleDateString(),
                'Badges here' // Placeholder
            ];

            rowData.forEach(data => {
                const td = document.createElement('td');
                td.style.border = '1px solid black';
                td.style.padding = '8px';
                td.innerHTML = data; // use innerHTML to allow colored rank
                row.appendChild(td);
            });

            table.appendChild(row);
        });

        container.appendChild(table);

        console.log(`Displayed ${players.length} player records.`);
    })
    .catch(error => {
        console.error('Error fetching player records:', error);
    });
}


window.addEventListener('load', function() {
    displayAllPlayerRecords();
    setInterval(displayAllPlayerRecords, 1000); // Reload every 2 seconds
});

  
  </script>
</body>
</html>
