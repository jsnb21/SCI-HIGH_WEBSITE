<!DOCTYPE html>
<html>
<head>
  <title>Game Stats</title>
</head>
<body>
  <h2>Leaderboards!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</h2>

  <!-- Div for player leaderboard -->
  <div id="playerRecordsContainer" style="padding: 20px; display: flex; justify-content: center; align-items: center; height: 100vh;"></div>


  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-Q2woACHgMCTVwd6aX-IUzLovE0ux-28",
      authDomain: "sci-high-website.firebaseapp.com",
      databaseURL: "https://sci-high-website-default-rtdb.asia-southeast1.firebasedatabase.app", // ✅ Added!
      projectId: "sci-high-website",
      storageBucket: "sci-high-website.appspot.com",
      messagingSenderId: "451463202515",
      appId: "1:451463202515:web:e7f9c7bf69c04c685ef626"
  };
  
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function convertRankToHTML(rankString) {
      // Mapping of RPGMaker color indexes to hex codes
      const colorMap = {
          16: "#FFD700", // Gold color for A Rank
          17: "#00FFFF", // Cyan color for S Rank
          18: "#FF4500", // Orange color for B Rank
          0: "#FFFFFF"   // Default white color
      };
  
      // Match the pattern \\C[n]
      const colorRegex = /\\C\[(\d+)\](.*?)\\C\[0\]/;
  
      const match = rankString.match(colorRegex);
      if (match) {
          const colorIndex = parseInt(match[1]);
          const text = match[2];
          const color = colorMap[colorIndex] || "#FFFFFF";
  
          return `<span style="color: ${color}; font-weight: bold;">${text}</span>`;
      } else {
          return rankString; // If no color code, return as is
      }
  }
  // / Function to display all player records from Firebase
  function displayAllPlayerRecords() {
    const db = firebase.database();
    
    db.ref('playerRecords')
      .orderByChild('score') // Order by score
      .once('value') 
      .then(snapshot => {
          const players = [];
          snapshot.forEach(childSnapshot => {
              players.push(childSnapshot.val());
          });

          players.reverse(); // High scores first

          const container = document.getElementById('playerRecordsContainer');
          if (!container) {
              console.warn('No container element found to display player records!');
              return;
          }

          // Clear the container before appending new content
          container.innerHTML = '';

          // Create a SINGLE wrapper div for all player elements
          const wrapper = document.createElement('div');
          wrapper.style.display = 'flex';
          wrapper.style.flexDirection = 'column';
          wrapper.style.alignItems = 'center';
          wrapper.style.width = '100%';

          players.forEach((player, index) => {
              const playerElement = document.createElement('div');
              const rankHtml = convertRankToHTML(player.rank);
              playerElement.style.color = 'black';
              playerElement.style.marginBottom = '10px';
              playerElement.innerHTML = `
                  <strong>#${index + 1}</strong> 
                  Name: ${player.name} | 
                  Score: ${player.score} | 
                  HTML: ${player.htmlScore} | 
                  CSS: ${player.cssScore} | 
                  Python: ${player.pythonScore} | 
                  DS: ${player.dsScore} |
                  Average Clear Time: ${player.clearTime} |
                  Average Mistakes Per Run: ${player.mistakes} |
                  Average Rank: ${rankHtml} |
                  Timestamp: ${new Date(player.timestamp).toLocaleString()}
                  Badges: 
              `;
              wrapper.appendChild(playerElement); // ✅ append to wrapper
          });
          container.appendChild(wrapper); // ✅ append wrapper once
          console.log(`Displayed ${players.length} player records.`);
      })
      .catch(error => {
          console.error('Error fetching player records:', error);
      });
}

window.addEventListener('load', function() {
    displayAllPlayerRecords();
    setInterval(displayAllPlayerRecords, 2000); // Reload every 2 seconds
});

  
  </script>
</body>
</html>
